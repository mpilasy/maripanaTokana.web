:80 {
	# Enable gzip compression for text assets
	encode gzip

	# Svelte app (root)
	@svelte {
		path / /index.html /manifest.json /service-worker.js
		path /*.js
		path /*.css
		path /*.png
		path /*.jpg
		path /*.jpeg
		path /*.gif
		path /*.svg
		path /*.woff
		path /*.woff2
		path /*.ttf
	}
	handle @svelte {
		root * /srv/svelte
		try_files {path} /index.html
		file_server
		# Versioned assets (with hash in filename) can be cached long-term
		header /.*\.[a-f0-9]{8}\.(js|css|woff2|ttf)$ Cache-Control "public, max-age=31536000, immutable"
		# HTML and service worker: no cache
		header /index.html Cache-Control "no-cache, public, must-revalidate"
		header /service-worker.js Cache-Control "no-cache, no-store, must-revalidate"
		# Manifest and other assets: moderate caching
		header /manifest.json Cache-Control "public, max-age=3600"
		header Cache-Control "public, max-age=3600"
	}

	# React app (/re/*)
	@react {
		path /re /re/*
	}
	handle @react {
		root * /srv/re
		rewrite * {path}
		try_files {path} /index.html
		file_server
		# Versioned assets
		header /.*\.[a-f0-9]{8}\.(js|css|woff2|ttf)$ Cache-Control "public, max-age=31536000, immutable"
		# HTML: no cache
		header /index.html Cache-Control "no-cache, public, must-revalidate"
		# Other assets: moderate caching
		header Cache-Control "public, max-age=3600"
	}

	# Angular app (/an/*)
	@angular {
		path /an /an/*
	}
	handle @angular {
		root * /srv/an
		rewrite * {path}
		try_files {path} /index.html
		file_server
		# Versioned assets
		header /.*\.[a-f0-9]{8}\.(js|css|woff2|ttf)$ Cache-Control "public, max-age=31536000, immutable"
		# HTML: no cache
		header /index.html Cache-Control "no-cache, public, must-revalidate"
		# Other assets: moderate caching
		header Cache-Control "public, max-age=3600"
	}
}
